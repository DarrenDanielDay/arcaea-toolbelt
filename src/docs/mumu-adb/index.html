<div class="page">
  <div class="toc-wrapper">
    <aside class="toc-content">
      <header>目录</header>
      <ul id="toc">
        <li>
          <a href="#install-mumu">1. 安装模拟器</a>
        </li>
        <li>
          <a href="#install-arcaea">2. 安装Arcaea</a>
        </li>
        <li>
          <a href="#sync-profile">3. 同步存档</a>
        </li>
        <li>
          <a href="#root">4. 开启Root权限</a>
        </li>
        <li>
          <a href="#confirm-port">5. 确认端口</a>
        </li>
        <li>
          <a href="#exec">6. 执行adb命令</a>
        </li>
        <li>
          <a href="#tool">7. 解析工具</a>
        </li>
      </ul>
    </aside>
  </div>
  <main>
    <p>本文介绍如何在Windows上使用MuMu模拟器获取Arcaea的本地存档<code>st3</code>文件。</p>
    <h3 id="install-mumu">1. 安装MuMu模拟器12</h3>
    <p>
      <a href="https://mumu.163.com/index.html" target="_blank">https://mumu.163.com/index.html</a>
    </p>
    <p>可以提前记一下安装目录，后面有用。</p>
    <h3 id="install-arcaea">2. 安装Arcaea</h3>
    <p>官网：<a href="https://arcaea.lowiro.com/" target="_blank">https://arcaea.lowiro.com/</a></p>
    <p>官网太慢可以试试第三方下载：<a href="https://616.sb/">https://616.sb/</a></p>
    <p>安装包文件下载完直接拖进模拟器即可自动安装。</p>
    <h3 id="sync-profile">3. 同步存档</h3>
    <p>
      模拟器上打开Arcaea，登录账号，同步云端的存档到模拟器上。记得提前在原设备上同步存档到云端，以及注意<strong>24小时内不要同时登录包括模拟器在内的三个以上设备</strong>。
    </p>
    <h3 id="root">4. 开启模拟器的Root权限</h3>
    <div class="imgs">
      <img src="../img/settings.png" loading="lazy" />
      <img src="../img/open-root.png" loading="lazy" />
    </div>
    <p>
      其实这才是用模拟器最主要的点，一般安卓设备出厂都是没有Root的，如果有刷过Root的手机，不用模拟器也可以用同样的方法拿到存档文件。
    </p>
    <p>
      开启了Root权限以后，你可以使用任何能够管理根目录的文件管理类App找到<code>st3</code>文件，位置是<code>/data/data/moe.low.arc/files/st3</code>，然后将它复制到MuMu共享文件夹，从而在电脑上拿到它。具体可参考官方说明：
      <a target="_blank" referrerpolicy="no-referrer" href="https://mumu.163.com/2017/06/20/25905_696022.html">
        https://mumu.163.com/2017/06/20/25905_696022.html
      </a>
      。
    </p>
    <p>
      这里也推荐一个开源免费的文件管理App：质感文件
      <a
        target="_blank"
        href="https://blog.dun.im/anonymous/materiai-fiies-material-design-file-manager-for-android.html"
        referrerpolicy="no-referrer"
      >
        https://blog.dun.im/anonymous/materiai-fiies-material-design-file-manager-for-android.html
      </a>
      。
    </p>
    <p>
      安装后如图所示找到<code>st3</code>文件，并复制到MuMu共享文件夹即可从模拟器内拿出来。访问根目录时App会申请root权限，勾选“永久记住选择”并允许即可。
    </p>
    <div class="imgs">
      <img src="../img/allow-root-access.png" />
      <img src="../img/find-st3.png" />
      <img src="../img/copy-st3.png" />
      <img src="../img/paste-st3.png" />
      <img src="../img/find-st3-on-pc.png" />
    </div>
    <p>
      你也可以将文件夹<code>/data/data/moe.low.arc/files</code>和<code>MuMu共享文件夹</code>设置为书签，方便找到文件夹。
    </p>
    <div class="imgs">
      <img src="../img/add-quick-link.png" />
    </div>
    <p>
      如果你经常做这些重复的操作，自然会容易感到厌烦。
      <strong>后面的操作步骤都是为了将复制文件的操作用批处理脚本自动化</strong
      >，方便后续拉取最新的<code>st3</code>的操作。如果在后面的自动化步骤碰到不好解决的问题，可以使用上面的App手动复制<code>st3</code>文件。
    </p>
    <h3 id="confirm-port">5. 确认端口</h3>
    <p>打开MuMu多开器，记一下模拟器用的adb端口号（这里是16384）。</p>
    <div class="imgs">
      <img src="../img/port.png" loading="lazy" />
    </div>
    <h3 id="exec">6. 执行adb命令</h3>
    <p>
      做安卓的同学应该比较熟悉adb，这里用的是MuMu模拟器安装后自带的adb。以root权限使用adb能够直接导出安卓文件系统内部的文件。这里提供两种操作方法。
    </p>
    <p>
      方法一：输入以下参数来直接生成带有完整命令的bat脚本，下载后直接双击运行即可，运行成功后即可在导出文件夹内找到st3存档文件。可以多次执行脚本，每次执行都会导出并覆盖原有文件。
    </p>
    <p>
      下载脚本时，浏览器可能会报告安全问题，因为恶意的脚本可能会窃取信息或损坏计算机。此生成的脚本没有这样的恶意代码，可以放心下载并保留。
    </p>
    <form class="mx-2" autocomplete="on">
      <div class="my-2">
        <label class="form-label" for="install-path">MuMu模拟器安装路径或shell路径</label>
        <input class="form-control" id="install-path" />
      </div>
      <div class="my-2">
        <label class="form-label" for="port">模拟器adb端口</label>
        <input class="form-control" id="port" type="number" min="0" max="65535" step="1" />
      </div>
      <div class="my-2">
        <label class="form-label" for="export-path">放导出存档的文件夹（需提前创建）</label>
        <input class="form-control" id="export-path" />
      </div>
      <p>生成的脚本内容：</p>
      <pre><div id="script-content"></div></pre>
      <p>
        <button type="button" class="btn btn-primary" id="download-script">下载脚本</button>
      </p>
    </form>
    <p>在第一次执行脚本的时候可能会弹出需要授予root权限的对话框，同样勾选“永久记住选择”并允许即可。</p>
    <div class="imgs">
      <img src="../img/allow-root-access.png" />
    </div>
    <p>方案二：手动执行adb命令。找到模拟器的安装目录下的shell文件夹，以此路径打开命令行工具。</p>
    <p>可通过空白处右键菜单-&gt;在终端打开：</p>
    <div class="imgs">
      <img src="../img/open-terminal.png" loading="lazy" />
    </div>
    <p>也可以直接在文件浏览器地址栏输入<code>powershell</code>或<code>cmd</code>并按回车来打开：</p>
    <div class="imgs">
      <img src="../img/open-powershell.gif" loading="lazy" />
    </div>
    <p>再在命令行内手动依次输入并回车执行以下几个命令，即可将模拟器内的本地存档复制到目标位置。</p>
    <pre><code><code><div>.\adb.exe root
.\adb.exe kill-server
.\adb.exe start-server
.\adb.exe connect 127.0.0.1:端口号
.\adb.exe -s 127.0.0.1:端口号 pull /data/data/moe.low.arc/files/st3 导出st3的文件夹</div></code></code></pre>
    <p>
      如下图所示，先在E盘创建<code>E:\temp\616sb</code>文件夹，然后用adb将
      <code>/data/data/moe.low.arc/files/st3</code>
      文件抽取到<code>616sb</code>文件夹下。初次执行可能需要授权，同样在模拟器内界面上点击允许即可。
    </p>
    <div class="imgs">
      <img src="../img/adb-pull.png" loading="lazy" />
    </div>
    <p>完成以后找到里面的<code>st3</code>文件即为包含本地分数的存档文件。</p>
    <div class="imgs">
      <img src="../img/st3.png" loading="lazy" />
    </div>
    <h3 id="tool">7. 解析工具</h3>
    <p>
      存档的格式是<code>sqlite</code>数据库文件。<code>Arcaea Toolbelt</code>的<a
        href="https://darrendanielday.github.io/arcaea-toolbelt"
        target="_blank"
        >主站</a
      >支持通过<code>st3</code>存档导入成绩并计算<code>b30</code>。
    </p>
    <p>
      此外还推荐一个<code>sqlite</code>数据库可视化工具<a href="https://www.sqlitestudio.pl/" target="_blank"
        >SQLiteStudio</a
      >，有兴趣可以尝试一下。
    </p>
  </main>
</div>
