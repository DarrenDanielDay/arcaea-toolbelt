# Arcaea 潜力值的机制介绍

本文的内容大多数来自于[Arcaea 中文 wiki](https://wiki.arcaea.cn)，笔者结合个人的理解进行了一些补充。

## 谱面定数

谱面除了标级表示难度以外，lowiro 内部还为每个谱面设置了一个更精确划分谱面难度的系数。lowiro 官方从未公布过定数的存在，目前的定数机制和定数数据都是玩家通过大量实验数据回归分析出的数学模型。

7 级及以下难度的谱面定数都是 0.5 的倍数，8 级及以上的谱面定数都是 0.1 的倍数。9 级以上的谱面在谱面定数小数部分为`.7~.9`时会显示`+`。dropdead 的 Future 难度标级 8，但是测试出的定数为 9.1，也是目前唯一一个标级与定数不符的谱面。

[定数测定工具](https://darrendanielday.github.io/arcaea-toolbelt/#/constant-tools)

## 单曲潜力值

根据结算的分数，可以算出一个修正系数，计算公式如下：

$$
\begin{equation}
modifier(score)=\left\{
	\begin{aligned}
	\frac{score - 9500000}{300000} &\quad score \le 9800000\\
	\frac{score - 9600000}{200000} &\quad 9800000 \lt score \lt 10000000\\
	2 &\quad score \ge 10000000 \\
	\end{aligned}
	\right
	.
\end{equation}


$$

其中 score 为得分。

简单记忆：三段折线的分段函数，PM 以上时为 2，恰好 EX（9800000）时为 1，EX 后每增加 20000 分增加 0.1，EX 以前每少 30000 分减少 0.1。常见值：

| 评级 | 分数     | 修正系数 |
| ---- | -------- | -------- |
| PM   | 10000000 | 2        |
| EX+  | 9900000  | 1.5      |
| EX   | 9800000  | 1        |
| AA   | 9500000  | 0        |
| A    | 9200000  | -1       |
| B    | 8900000  | -2       |

修正系数下不封底。

单曲潜力值计算公式：

$$
potential(score, constant) = max \{0, \space constant + modifier(score) \}
$$

其中 score 为谱面分数，constant 为谱面定数。单曲潜力值不会是负值。

[单曲潜力值计算工具](https://darrendanielday.github.io/arcaea-toolbelt/#/chart-ptt)

## best30

best30，简称 b30，是玩家所有谱面历史最佳分数对应单曲潜力值的前 30 个的总和，若玩家游玩谱面不满 30 个则取全部游玩过的谱面的最佳分数单曲潜力值的总和。由于参与计算的是历史最佳成绩，因此 best30 只会增加，不会减少。注意谱面不是曲目，即允许同个曲目不同难度谱面的成绩同时参与计算。

[best30 计算工具](https://darrendanielday.github.io/arcaea-toolbelt/#/profile)

## recent30 与 recent10

recent30 是玩家“最近游玩”的若干谱面成绩的队列（允许有相同谱面），容量为 30。当玩家提交了 30 次游玩成绩后，该队列会被写入到满的状态，此后提交的成绩写入 recent30 队列时，会同时移除队列内的一个成绩，保证队列内成绩数量不超过 30。在满队列的情况下提交一个成绩，若不满足	`条件写入`的条件，recent30 内最早提交的成绩将被移除，本次提交的成绩将被写入队列。如果满足以下条件之一，则会执行`条件写入`：

1. 初次提交该谱面的成绩（初见保护）
2. 分数达到 EX 评级（EX 保护）
3. 困难血条下 Track Lost（困难保护，需要注意不包括的典型角色：光（Fracture）、光（Zero），都是普通血条）
4. 成绩高于该谱面的历史最佳成绩（推分保护，未完全公认，但已有大量实践验证）

`条件写入`：如果本次提交的谱面成绩的单曲潜力值高于 recent30 内最低的单曲潜力值，则将此单曲潜力值最低的成绩移除，并将本次提交的成绩写入队列，否则本次提交的成绩将被舍弃（不影响 recent30 队列）。可以看出，`条件写入`一定不会导致 rencent30 内的单曲潜力值减少。

recent10，简称 r10，是 recent30 队列内不相同的谱面的最高成绩对应单曲潜力值的前 10 个的总和，不满 10 个不同谱面时和 best30 不满 30 个谱面同理。中文 wiki 上提到写出时会保证 recent30 内不会少于 10 个不同谱面，但具体细节机制无从得知。

## 玩家潜力值

计算公式：

$$
playerPotential = \frac{best30+recent10}{40}
$$

由于 best30 只会增加不会减少，因此玩家潜力值减少一定是因为 recent10 减少。而`条件写入`也能保证 recent10 不会减少，因此玩家潜力值减少也一定是因为提交的成绩没有满足`条件写入`的任何一个条件，并且移除了 recent30 内一个最早的成绩，且该成绩的单曲潜力值较高。因此，即使将导致潜力值下降那次提交的谱面打到EX，或者打出历史新高，扣掉的潜力值也不一定会加回来，想加回来需要打的是被移除的成绩的谱面（打回来的时候还不能再挤掉其他较高的成绩，也就是最好触发`条件写入`）。

游戏内显示的潜力值是小数点后两位的截尾（11.999999 也会显示 11.99）。若一个谱面成绩结算后应当显示的潜力值与当前显示值存在差值，则会显示对应的变化值（+0.01，-0.01，等等）。因此，即使推了 best30 里的成绩，如果潜力值不能发生百分位进位的变化，也不会显示+0.01。若有多设备游玩，潜力值未及时同步也会在结算后显示相应的变化值。

当 best30 内的单曲潜力值最高的 10 个成绩恰好是 recent10 的 10 个成绩时，计算出的玩家潜力值达到了当前不推分的最大值，也就是曾经各大查分 bot 会计算的“无推分最大 ptt”，这个值只需要将 best30 前 10 的成绩重新打出一遍即可达到，作为一个不掉分情况下潜力值的参考值。

## 参考资料

[Arcaea 中文 Wiki：潜力值](https://wiki.arcaea.cn/%E6%BD%9C%E5%8A%9B%E5%80%BC)
